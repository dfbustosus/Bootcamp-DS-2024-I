/*! For license information please see streamer.57000c6ad7eb9712603d.mjs.LICENSE.txt */
(()=>{"use strict";var e={8277:(e,t,s)=>{s.r(t);var r=s(3379),i=s.n(r),n=s(9037),o=s.n(n),a=s(569),c=s.n(a),l=s(3565),u=s.n(l),f=s(9216),h=s.n(f),d=s(1603),b={};b.setAttributes=u(),b.insert=c().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=h(),i()(d.Z,b);const m=d.Z&&d.Z.locals?d.Z.locals:void 0;function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},p.apply(this,arguments)}const g="streamer",y="txt",v="data-field",k="data-symbol",w="data-stream",M="value",S="active";class P extends HTMLElement{constructor(){super(),this.initialized=!1,this.cssToggle=!1,this.value=void 0,this.transform=null,this.onUpdate=this.onUpdate.bind(this)}static get observedAttributes(){return[k,v,S]}onUpdate(e,{field:t,quote:s}={}){if(!e&&"number"!=typeof e)return;const r="object"!=typeof e?{raw:e,fmt:e}:e,{raw:i}=r;if(this.value!==i){const e=this.getAttribute("changeev");e&&this.dispatchEvent(new CustomEvent(`finWebCore_${e}`,{detail:p({},r,{field:t,quote:s}),bubbles:!0})),this.cssToggle=!this.cssToggle;const n=i-this.value;this.value=i,this.render(p({},r,{trend:n}))}}subscribe({symbols:e,fields:t}){var s;e&&t&&e.length&&t.length&&this.hasAttribute(S)&&"function"==typeof(null==(s=window.finQuoteStreamer)?void 0:s.subscribe)&&window.finQuoteStreamer.subscribe({symbols:e,fields:t,userId:this.getAttribute("data-userid")||"",type:this.getAttribute(w)||g,priceHint:this.getAttribute("data-pricehint"),formatStyle:this.getAttribute("data-fstyle"),callback:this.onUpdate})}unsubscribe({symbols:e,fields:t}){var s;e&&t&&e.length&&t.length&&"function"==typeof(null==(s=window.finQuoteStreamer)?void 0:s.unsubscribe)&&window.finQuoteStreamer.unsubscribe({symbols:e,fields:t,type:this.getAttribute(w)||g,callback:this.onUpdate})}connectedCallback(){if(!this.initialized){const e=this.getAttribute(v),t=this.getAttribute(k);this.value=parseFloat(this.getAttribute(M)||""),t&&e&&this.subscribe({symbols:[t],fields:[e]}),this.initialized=!0}}disconnectedCallback(){const e=this.getAttribute(v),t=this.getAttribute(k);t&&e&&this.unsubscribe({symbols:[t],fields:[e]}),this.initialized=!1}attributeChangedCallback(e,t,s){if(this.initialized)switch(e){case k:t!==s&&s&&(this.unsubscribe({symbols:[t],fields:[this.getAttribute(v)]}),this.subscribe({symbols:[s],fields:[this.getAttribute(v)]}));break;case v:t!==s&&s&&(this.unsubscribe({symbols:[this.getAttribute(k)],fields:[t]}),this.subscribe({symbols:[this.getAttribute(k)],fields:[s]}));break;case S:{const e=null!==t,r=null!==s;e&&!r?this.unsubscribe({symbols:[this.getAttribute(k)],fields:[this.getAttribute(v)]}):!e&&r&&this.subscribe({symbols:[this.getAttribute(k)],fields:[this.getAttribute(v)]})}break;case M:this.value=parseFloat(s)}}render(e){"function"==typeof this.transform&&(e=this.transform(e));const{raw:t,trend:s}=e,r=this.getAttribute("data-trend")||y,i=this.getAttribute("data-template"),n=this.getAttribute("data-dfield")||"fmt",o="arrow"===this.getAttribute("data-tstyle");let a=m.base,c="";if(t>0)switch(r){case"bg":a+=` ${m.posBgColor}`,c=o?"↑ ":"+";break;case y:a+=` ${m.posColor}`,c=o?"↑ ":"+"}else if(t<0)switch(r){case"bg":a+=` ${m.negBgColor}`,o&&(c="↓ ");break;case y:a+=` ${m.negColor}`,o&&(c="↓ ")}s>0?a+=` ${this.cssToggle?m.trendUp1:m.trendUp2}`:s<0&&(a+=` ${this.cssToggle?m.trendDown1:m.trendDown2}`);let l=c+(e[n]||"");o&&(l=l.replace("-","")),i&&(l=function(e,t){let s=e,r=!1;return Object.keys(t).forEach((e=>{t[e]&&(r=!0),s=s.replace(new RegExp(`{${e}}`,"g"),t[e])})),r?s:""}(i,{raw:t,fmt:l})),this.children[0]?(this.children[0].className=a,this.children[0].textContent=l):this.innerHTML=`<span class="${a}">${l}</span>`}}window.customElements&&!window.customElements.get("fin-streamer")&&window.customElements.define("fin-streamer",P)},1603:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(8081),i=s.n(r),n=s(3645),o=s.n(n)()(i());o.push([e.id,':root{--finc-text1:var(--text1,#232a31);--finc-text2:var(--text2,#464e56);--finc-text3:var(--text3,#5b636a);--finc-separator:var(--separator,#e0e4e9);--finc-link:var(--link,#0f69ff);--finc-link-active:var(--link-active,#125bd4);--finc-link-selected:var(--link-selected,#7e1fff);--finc-link-inverse:var(--link-inverse,#e0f0ff);--finc-surface1:var(--surface1,#fff) #fff;--finc-surface2:var(--surface2,#f0f3f5);--finc-surface3:var(--surface3,#fff);--finc-surface4:var(--surface4,#fff);--finc-positive:var(--positive,#037b4b);--finc-negative:var(--negative,#d60a22);--finc-neutral:var(--neutral,#5b636a);--finc-positive-bg:var(--positive-bg,rgba(0,133,60,.102));--finc-negative-bg:var(--negative-bg,rgba(189,20,20,.102))}.a405bf5d{color:blue}.e3b14781{position:relative;white-space:nowrap;z-index:0}.e3b14781:after,.e3b14781:before,.a7c78a61{content:"";display:block;height:100%;left:0;opacity:0;position:absolute;top:0;width:100%;z-index:-1}.e3b14781:after,.e3b14781:before{pointer-events:none;will-change:opacity}.e3b14781:before{background-color:rgba(0,133,60,.102);background-color:var(--finc-positive-bg)}.e3b14781:after{background-color:rgba(189,20,20,.102);background-color:var(--finc-negative-bg)}.f4be3290{color:#037b4b;color:var(--finc-positive)}.ee3e99dd{color:#d60a22;color:var(--finc-negative)}.b3c3f2ca{background-color:#037b4b;background-color:var(--finc-positive)}.cd7d43ff,.b3c3f2ca{border-radius:3px;color:#fff;padding:2px 10px}.cd7d43ff{background-color:#d60a22;background-color:var(--finc-negative)}.a6c2a027{font-size:0.75rem}.f5193b25{font-size:0.875rem;font-weight:700}.bf673e9a{font-weight:500;margin-left:4px}@keyframes ed961825{25%{opacity:1}75%{opacity:1}to{opacity:0}}@keyframes de628db8{25%{opacity:1}75%{opacity:1}to{opacity:0}}@keyframes e816a496{25%{opacity:1}75%{opacity:1}to{opacity:0}}@keyframes f90c4216{25%{opacity:1}75%{opacity:1}to{opacity:0}}.e887be10{background-color:rgba(0,133,60,.102);background-color:var(--finc-positive-bg)}.b0e44130{background-color:rgba(189,20,20,.102);background-color:var(--finc-negative-bg)}.f5a023e1:before{animation:ed961825 .7s}.e983cf79:before{animation:de628db8 .7s}.e59c8479:after{animation:e816a496 .7s}.dde7f18a:after{animation:f90c4216 .7s}',""]),o.locals={activeMarketColor:"#ff7b12","c-fuji-blurple":"#5d5eff","c-fuji-grape-jelly":"#6001d2",boxShadow:"0 2px 4px rgba(0,0,0,.2)",overlayModalBgColor:"rgba(50,50,50,0.6)",newsItemWidth:"calc(100% - 50px)",xs:"0.688rem",xss:"0.75rem",s:"0.813rem",sm:"0.875rem",m:"0.938rem",ml:"1rem",l:"1.125rem",dummy:"a405bf5d",base:"e3b14781",baseCommon:"a7c78a61",posColor:"f4be3290",negColor:"ee3e99dd",posBgColor:"b3c3f2ca",negBgColor:"cd7d43ff",marketNotice:"a6c2a027",prepostCont:"f5193b25",prepostChange:"bf673e9a",trendUp:"e887be10",trendDown:"b0e44130",trendUp1:"f5a023e1",trendAnimUp1:"ed961825",trendUp2:"e983cf79",trendAnimUp2:"de628db8",trendDown1:"e59c8479",trendAnimDown1:"e816a496",trendDown2:"dde7f18a",trendAnimDown2:"f90c4216"};const a=o},3645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",r=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),r&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),r&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,r,i,n){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var u=[].concat(e[l]);r&&o[u[0]]||(void 0!==n&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=n),s&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=s):u[2]=s),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),t.push(u))}},t}},8081:e=>{e.exports=function(e){return e[1]}},3379:e=>{var t=[];function s(e){for(var s=-1,r=0;r<t.length;r++)if(t[r].identifier===e){s=r;break}return s}function r(e,r){for(var n={},o=[],a=0;a<e.length;a++){var c=e[a],l=r.base?c[0]+r.base:c[0],u=n[l]||0,f="".concat(l," ").concat(u);n[l]=u+1;var h=s(f),d={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)t[h].references++,t[h].updater(d);else{var b=i(d,r);r.byIndex=a,t.splice(a,0,{identifier:f,updater:b,references:1})}o.push(f)}return o}function i(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,i){var n=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<n.length;o++){var a=s(n[o]);t[a].references--}for(var c=r(e,i),l=0;l<n.length;l++){var u=s(n[l]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}n=c}}},569:e=>{var t={};e.exports=function(e,s){var r=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(s)}},9216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},9037:e=>{var t,s=(t=[],function(e,s){return t[e]=s,t.filter(Boolean).join("\n")});function r(e,t,r,i){var n;if(r)n="";else{n="",i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var o=void 0!==i.layer;o&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,o&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}")}if(e.styleSheet)e.styleSheet.cssText=s(t,n);else{var a=document.createTextNode(n),c=e.childNodes;c[t]&&e.removeChild(c[t]),c.length?e.insertBefore(a,c[t]):e.appendChild(a)}}var i={singleton:null,singletonCounter:0};e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=i.singletonCounter++,s=i.singleton||(i.singleton=e.insertStyleElement(e));return{update:function(e){r(s,t,!1,e)},remove:function(e){r(s,t,!0,e)}}}},477:e=>{e.exports=function(e,t,s,r){var i=self||window;try{try{var n;try{n=new i.Blob([e])}catch(t){(n=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),n=n.getBlob()}var o=i.URL||i.webkitURL,a=o.createObjectURL(n),c=new i[t](a,s);return o.revokeObjectURL(a),c}catch(r){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),s)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new i[t](r,s)}}}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={id:r,exports:{}};return e[r](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="https://s.yimg.com/uc/finance/webcore/",s.nc=void 0,(()=>{var e=s(477),t=s.n(e);function r(){return t()('/*! For license information please see portfolio.worker.74a3fb06c0df9d13a2f0.worker.mjs.LICENSE.txt */\n(()=>{"use strict";function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},t.apply(this,arguments)}function e(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const s=["quoteType","regularMarketPrice","regularMarketChange","regularMarketChangePercent","currency"],r=["annualGainPercentage","currentMarketValue","dailyGain","purchasedMarketValue","totalGain"],a=[...r,"dailyPercentGain","totalPercentGain"];class i{constructor({messagePort:i,streamerPort:o}={messagePort:null,streamerPort:null}){var n=this;e(this,"getCurrentMarketValue",((t,e)=>t&&e?t*e:0)),e(this,"getDailyGain",((t,e)=>t&&e?t*e:0)),e(this,"getTotalGain",((t,e,s)=>t&&e&&s?t*(s-e):0)),e(this,"getTotalPercentGain",((t,e)=>t&&e?(e-t)/t:0)),e(this,"getAnnualGain",((t,e,s,r)=>{if(!t)return 0;let a;if(s)a=new Date(+s.slice(0,4),+s.slice(4,6)-1,+s.slice(6,8)).getTime();else{const t=new Date;t.setHours(0,0,0,0),t.setMonth(0,1),a=t.getTime()}return(e/t)**(365/((r-a)/864e5|0))-1})),e(this,"getExchangeRate",((t,e,s)=>{let r=1;if(t!==e){var a;const i=`${"USD"===e?"":e}${t}=X`;null!=(a=s[i])&&a.regularMarketPrice&&(r=s[i].regularMarketPrice,"GBp"===t&&(r*=100))}return r})),e(this,"getSymbolExchangeRate",((t,e,s)=>{const r=s[e];return this.getExchangeRate(r.currency,t,s)})),e(this,"getSubscriptionSymbols",(()=>{const t=[],e=[],{quotes:s}=this.portfolios;for(let a=0;a<this.pfIdList.length;a++){var r;const i=this.pfIdList[a],o=null!=(r=this.portfolios.portfolios[i])?r:{},{baseCurrency:n="USD",cashPosition:l,cashCurrency:c="USD",currentMarketValue:u,positions:h=[]}=o;if(Array.isArray(h)&&h.length>0&&"number"==typeof u)for(let r=0;r<h.length;r++){const{lots:a,symbol:i}=h[r];if((null==a?void 0:a.length)>0&&s[i]){const{currency:r}=s[i];r&&r!==n&&(e.push(`${n}${r}=X`),e.push(`${r}${n}=X`)),t.push(i)}}"number"==typeof l&&c!==n&&(e.push(`${n}${c}=X`),e.push(`${c}${n}=X`))}return[...new Set(t.concat(e))]})),e(this,"computePortfolios",(t=>{const e={currentMarketValue:0,purchasedMarketValue:0,totalGain:0,dailyGain:0,totalPercentGain:0,dailyPercentGain:0,annualGainPercentage:0},s={all:{price:{priceHint:2}}},r=new Set(this.pfIdList),i=Object.keys(this.portfolios.portfolios);for(let o=0;o<i.length;o++){const n=i[o],l=this.portfolios.portfolios[n];this.computePortfolio(l,t);const c=r.has(n);c&&(s[n]={price:{priceHint:2}}),a.forEach((t=>{e[t]+=l[t]||0,c&&(s[n].price[t]=l[t]||0)}))}return a.forEach((t=>{this.portfolios[t]=e[t],s.all.price[t]=this.portfolios[t]})),s})),e(this,"computePortfolio",((e,s)=>{if(!e||!e.includeInTotalCalculation)return;const{positions:i=[],baseCurrency:o="USD",pfId:n}=null!=e?e:{},l={currentMarketValue:0,purchasedMarketValue:0,totalGain:0,dailyGain:0,totalPercentGain:0,dailyPercentGain:0};if("number"==typeof e.cashPosition){const t=this.getExchangeRate(e.cashCurrency,o,s);l.currentMarketValue+=e.cashPosition/t}for(let e=0;e<i.length;e++){const a=i[e],{lots:n,symbol:c}=a,u=s[c],h={currentMarketValue:0,purchasedMarketValue:0,totalGain:0,dailyGain:0,totalPercentGain:0,dailyPercentGain:0,annualGainPercentage:0};if((null==n?void 0:n.length)>0&&u&&"$$CASH"!==c&&u.currency){const a=this.getSymbolExchangeRate(o,c,s),l=Date.now();for(let s=0;s<n.length;s++){const o=n[s],c={},{regularMarketPrice:p,regularMarketChange:f,regularMarketChangePercent:d,quoteType:g}=u,m="OPTION"===g?100*o.quantity:o.quantity;let b=1;"number"==typeof m&&(b=m<0?-1:1,c.currentMarketValue=this.getCurrentMarketValue(m,p)/a,o.purchasePrice&&(c.totalGain=this.getTotalGain(m,o.purchasePrice,p)/a,c.purchasedMarketValue=Math.abs(m)*o.purchasePrice/a),"number"==typeof f&&(c.dailyGain=this.getDailyGain(m,f)/a)),"number"==typeof p&&"number"==typeof o.purchasePrice&&(c.totalPercentGain=this.getTotalPercentGain(o.purchasePrice,p)*b,c.annualGainPercentage=this.getAnnualGain(o.purchasePrice,p,o.tradeDate,l)),"number"==typeof d&&(c.dailyPercentGain=d*b),i[e].lots[s]=t({},n[s],c),r.forEach((t=>{h[t]+="number"==typeof n[s][t]?n[s][t]:0}))}}r.forEach((t=>{i[e][t]=h[t],l[t]+=i[e][t]})),i[e].dailyPercentGain=i[e].dailyGain?100*i[e].dailyGain/Math.abs(i[e].currentMarketValue-i[e].dailyGain):0,i[e].totalPercentGain=i[e].purchasedMarketValue?100*i[e].totalGain/i[e].purchasedMarketValue:0}l.dailyPercentGain=l.dailyGain?100*l.dailyGain/Math.abs(l.currentMarketValue-l.dailyGain):0,l.totalPercentGain=l.purchasedMarketValue?100*l.totalGain/l.purchasedMarketValue:0,a.forEach((t=>{this.portfolios.portfolios[n][t]=l[t]}))})),e(this,"onStreamerMessage",(e=>{var s;const{data:r}=e,{quoteData:a}=r||{};a&&0!==this.pfIdList.length&&null!=(s=this.portfolios)&&s.portfolios&&(Object.keys(a).forEach((e=>{const s=t({},a[e].price,a[e].summaryDetail);this.portfolios.quotes[e]=t({},this.portfolios.quotes[e],s)})),this.sendUpdate())})),e(this,"parsePfResponse",(e=>{const[s]=e.finance.result,r={};s.portfolios.forEach((t=>{r[t.pfId]=t})),this.portfolios=t({},s),this.portfolios.portfolios=r})),e(this,"resetPolling",(()=>{this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=null),this._fetching=!1})),e(this,"fetchPortfolios",(async function({crumb:t="",userId:e=""}={}){if(n._fetching)return;n._fetching=!0;const r=n.crumb||t||"",a=n.userId||e||"";try{const t=await function(t,{method:e="GET",body:s,timeout:r=3e3}={}){return new Promise(((a,i)=>{const o=new XMLHttpRequest;o.open(e,t,!0),o.timeout=r,o.withCredentials=!0,o.onload=()=>{let t=o.responseText;if(o.status>=200&&o.status<300&&t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return void i({status:502,message:t.message})}a(t)}else i({status:o.status||502,message:o.responseText})},o.onerror=()=>{i({status:o.status||500,message:o.responseText})},o.send(s)}))}(`https://query2.finance.yahoo.com/v7/finance/desktop/portfolio?formatted=false&fields=${s.join(",")}&crumb=${r}&userId=${a}&includeBetaVersion=1&lotCount=10&userIdType=guid`);n._fetching=!1,n.parsePfResponse(t),n.sendUpdate()}catch(t){console.error("> finance portfolio.streamer:",t)}})),e(this,"loadPortfolios",(async function({crumb:t="",userId:e=""}={}){n.resetPolling(),n.fetchPortfolios({crumb:t,userId:e}),n.intervalHandle=setInterval(n.fetchPortfolios,15e3)})),e(this,"subscribe",(async function({crumb:t="",userId:e="",symbols:s=[]}={}){s.length>n.pfIdList.length&&(s.filter((t=>{const[e]=t.split(":");return!n.portfolios.portfolios[e]})).length>0&&await n.loadPortfolios({crumb:t,userId:e}),n.update({crumb:t,symbols:s,userId:e,op:"subscribe"}),n.messagePort.postMessage({cmd:"subscribe",type:"streamer",symbols:n.getSubscriptionSymbols()}))})),e(this,"unsubscribe",(({crumb:t="",symbols:e=[]}={})=>{this.pfIdList.length&&e.length&&(this.messagePort.postMessage({cmd:"unsubscribe",type:"streamer",symbols:this.getSubscriptionSymbols()}),this.update({crumb:t,symbols:e,userId:"",op:"unsubscribe"}),0===this.pfIdList.length&&this.resetPolling())})),e(this,"destroy",(()=>{this.portfolios={portfolios:{},quotes:{}},this.pfIdList=[],this.crumb=""})),e(this,"update",(({crumb:t,symbols:e,userId:s,op:r})=>{if(this.crumb=t||"","subscribe"===r)this.pfIdList=[...new Set(this.pfIdList.concat(e.map((t=>t.split(":")[0]))))];else for(let t=0;t<e.length;t++){const[s]=e[t].split(":"),r=this.pfIdList.indexOf(s);r>-1&&this.pfIdList.splice(r,1)}s&&(this.userId=s)})),this.portfolios={portfolios:{},quotes:{}},this.messagePort=i,this.streamerPort=o,this.pfIdList=[],this.crumb="",this.userId="",this.intervalHandle=null,this._fetching=!1}sendUpdate(){const t=this.computePortfolios(this.portfolios.quotes);this.messagePort.postMessage({quoteData:t})}}let o=null,n=null,l=null;function c(t){const{data:e}=t;switch(e.cmd){case"subscribe":l||(l=new i({messagePort:o,streamerPort:n})),l.subscribe(e);break;case"unsubscribe":l.unsubscribe(e);break;case"destroy":l&&(l.destroy(),l=null)}}addEventListener("message",(t=>{const{data:e}=t;switch(e.cmd){case"init":[o]=t.ports,o.onmessage=c;break;case"init-qpf":[n]=t.ports,n.onmessage=t=>{l&&l.onStreamerMessage.call(l,t)}}}),!1)})();',"Worker",void 0,s.p+"js/portfolio.worker.74a3fb06c0df9d13a2f0.worker.mjs")}function i(){return t()('/*! For license information please see streamer.worker.0cc18a7fda3de545f30a.worker.mjs.LICENSE.txt */\n(()=>{function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},e.apply(this,arguments)}function t(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}try{"function"==typeof importScripts&&(importScripts("https://cdn.jsdelivr.net/npm/protobufjs@7.1.2/dist/minimal/protobuf.min.js"),importScripts("https://s.yimg.com/uc/finance/webcore/js/_staticFinProtobuf.3c40287e380347075362.mjs"))}catch(e){console.error("> Finance Streamer: Importing protobuff failed.",e)}const s="https://query1.finance.yahoo.com/v7/finance/quote?";let r=null,n=null,i=null,o=null;const a={id:"symbol",dayVolume:"volume",dayHigh:"high",dayLow:"low",marketcap:"marketCap",marketHours:"marketState",openPrice:"regularMarketOpen",fromcurrency:"fromCurrency",vol_24hr:"volume24Hr",volAllCurrencies:"volumeAllCurrencies"},c={ask:!0,askSize:!0,bid:!0,bidSize:!0,dayLow:!0,dayHigh:!0,expireDate:!0},l={},u={change:!0,changePercent:!0,previousClose:!0,price:!0},h={_permanent:!0};function m(e,t){let s;return(...r)=>{clearTimeout(s),s=setTimeout((()=>e(...r)),t)}}function d(e,t){if(isNaN(e))return e;const s=Math.pow(10,t);return+Math.round(e*s)/s}function b(e,{timeout:t=1e3,callback:s}){const r=new XMLHttpRequest;r.timeout=t,r.withCredentials=!0,r.open("GET",e,!0),r.onload=()=>{let e=r.responseText;if(r.status>=200&&r.status<300&&e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return void s({status:502,message:e.message})}s(null,e)}else s({status:r.status||502,message:r.responseText})},r.onerror=()=>{s({status:r.status||500,message:r.responseText})},r.send()}class f{constructor(){this.crumb="",this.symbolList=[],this.fieldList=[],this.connection=null}update({crumb:e,symbols:t,fields:s}){this.crumb=e||"",this.symbolList=t,this.fieldList=s}reset(){this.fieldList=[],this.symbolList=[]}}class p extends f{constructor(){super(),this.intervalHandle=null,this.handleQuoteRequest=this.handleQuoteRequest.bind(this),this.subscribe=m(this.subscribe.bind(this),1e3)}resetPoller(){this.intervalHandle&&clearInterval(this.intervalHandle),this.intervalHandle=setInterval((()=>{b(`${s}&symbols=${this.symbolList.sort().join(",")}&fields=${this.fieldList.filter((e=>!h[e])).join(",")}&crumb=${this.crumb||""}`,{callback:this.handleQuoteRequest})}),5e3)}subscribe(e){const{crumb:t,symbols:s=[],fields:r=[]}=e||{},n=s.length>this.symbolList.length,i=r.length>this.fieldList.length;this.update({crumb:t,symbols:s,fields:r}),(n||i)&&this.resetPoller()}unsubscribe(e){const{crumb:t,symbols:s=[],fields:r=[]}=e||{},n=s.length<this.symbolList.length,i=r.length<this.fieldList.length;this.update({crumb:t,symbols:s,fields:r}),(n||i)&&(0!==this.symbolList.length?this.resetPoller():this.destroy())}destroy(){this.reset(),this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=null)}handleQuoteRequest(e,t){if(!e&&t){const e={type:"poller",quoteData:{}},s=t.quoteResponse&&t.quoteResponse.result;for(let t=0;t<s.length;t++){const r=s[t],{symbol:n}=r;e.quoteData[n]={price:r,summaryDetail:{}}}i.postMessage(e),o.postMessage(e)}else console.error("> Error from Finance Quote Streamer:",e)}}const y=["currency","exchangeTimezoneName","exchangeTimezoneShortName","gmtOffSetMilliseconds","regularMarketChange","regularMarketChangePercent","regularMarketPrice","regularMarketTime","preMarketTime","postMarketTime","extendedMarketTime"];class g extends f{constructor(){super(),t(this,"handleWebSocketUpdate",(t=>{try{const{PricingData:s}=protobuf.roots.default.quotefeeder,r=function(e){const t=atob(e),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return r}(t.data);let n=s.decode(r);n=s.toObject(n,{enums:String}),Array.isArray(n)||(n=[n]),n.forEach((t=>{null!=t&&t.id&&(this.quoteData[t.id]=e({},this.quoteData[t.id],function(e){const t={},s={},{marketHours:r}=e,n=e.priceHint||2;let i,o="";switch(r){case"PRE_MARKET":o="preMarket",i="PRE";break;case"REGULAR_MARKET":o="regularMarket",i="REGULAR";break;case"POST_MARKET":o="postMarket",i="POST";break;case"EXTENDED_HOURS_MARKET":o="extendedMarket",i="EXTENDED"}for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let h=a[r]||r,m=e[r];if(null==m||""===m)continue;switch(h){case"previousClose":case"price":case"time":case"dayHigh":case"dayLow":case"volume":case"changePercent":case"change":u[h]&&!isNaN(m)&&(m=d(m,n)),"time"===h&&(m/=1e3),h=o+h[0].toUpperCase()+h.substr(1);break;case"marketState":m=i}c[h]?s[h]=m:l[h]||(t[h]=m)}return{price:t,summaryDetail:s}}(t)))})),i.postMessage({type:"streamer",quoteData:this.quoteData}),o.postMessage({type:"streamer",quoteData:this.quoteData})}catch(e){console.error("> Error from Finance Quote Streamer:",e)}})),t(this,"handleQuoteRequest",((t,s)=>{if(!t&&s){var r;const t=null==(r=s.quoteResponse)?void 0:r.result;if(!t)return;for(let s=0;s<t.length;s++){const r=t[s],{symbol:n}=r;this.quoteData[n]=e({},this.quoteData[n],r)}i.postMessage({type:"streamer",quoteData:this.quoteData}),o.postMessage({type:"streamer",quoteData:this.quoteData})}else console.error("> Error from Finance Quote Streamer:",t)})),this.connection=null,this.retries=0,this.quoteData={},this.sendConnection=m(this.sendConnection.bind(this),1e3)}seedQuoteData(){const e=this.symbolList.filter((e=>{var t;return!(null!=(t=this.quoteData[e])&&t.exchangeTimezoneName)}));if(e.length>0&&this.crumb){e.sort();const r=[[]];let n=0;for(let s=0;s<e.length;s++){var t;null!=(t=this.quoteData[s])&&t.currency||r[n].push(e[s]),30===r[n].length&&(n++,r[n]=[])}r.forEach((e=>{b(`${s}&symbols=${e.join(",")}&fields=${y.join(",")}&crumb=${this.crumb||""}&formatted=false&region=US&lang=en-US`,{callback:this.handleQuoteRequest})}))}}subscribe(e){var t,s;const{crumb:r,symbols:n=[],fields:i=[]}=e||{};if(this.update({crumb:r,symbols:n,fields:i}),!this.connection||(null==(t=this.connection)?void 0:t.readyState)!==WebSocket.OPEN&&(null==(s=this.connection)?void 0:s.readyState)!==WebSocket.CONNECTING){const e=()=>{this.retries>10||(this.connection=new WebSocket("wss://streamer.finance.yahoo.com"),this.connection.addEventListener("open",(()=>{this.sendConnection(JSON.stringify({subscribe:this.symbolList}))})),this.connection.addEventListener("error",(t=>{t&&"ECONNREFUSED"===t.code&&(this.retries++,e())})),this.connection.addEventListener("close",(t=>{t&&1e3!==t.code&&(this.retries++,e())})),this.connection.addEventListener("message",this.handleWebSocketUpdate))};e()}else this.connection.readyState===WebSocket.OPEN&&this.symbolList.length>0&&this.sendConnection(JSON.stringify({subscribe:this.symbolList}))}unsubscribe(e){var t;const{crumb:s,symbols:r=[],fields:n=[]}=e||{},i=new Set(r),o=this.symbolList.filter((e=>!i.has(e)));this.update({crumb:s,symbols:r,fields:n}),(null==(t=this.connection)?void 0:t.readyState)===WebSocket.OPEN&&o.length>0&&this.sendConnection(JSON.stringify({unsubscribe:o}))}destroy(){this.reset(),this.connection&&(this.connection.close(),this.connection=null)}sendConnection(e){this.connection.send(e),e.includes("subscribe")&&this.seedQuoteData()}}function v(e="streamer"){return"poller"===e?(n||(n=new p),n):(r||(r=new g),r)}function S(e){const{data:t}=e,{type:s}=t||{};switch(t.cmd){case"subscribe":v(s).subscribe(t);break;case"unsubscribe":v(s).unsubscribe(t);break;case"destroy":"poller"===s&&n&&(n.destroy(),n=null),"streamer"===s&&r&&(r.destroy(),r=null)}}function k(){}protobuf||console.error("> Finance Streamer: Protobuff library missing so cannot use streamer"),addEventListener("message",(e=>{const{data:t}=e;switch(t.cmd){case"init":[i]=e.ports,i.onmessage=S;break;case"init-qpf":[o]=e.ports,o.onmessage=k,o.postMessage({cmd:"Hello Portfolio worker from streamer worker"})}}),!1)})();',"Worker",void 0,s.p+"js/streamer.worker.0cc18a7fda3de545f30a.worker.mjs")}function n(e="error",t,s={}){try{var r;if("function"==typeof(null==(r=window.context)?void 0:r.getActionContext)){const r=window.context.getActionContext();"function"==typeof r.beacon&&r.beacon(e,t,s)}else console["error"===e?"error":"log"](e,t,JSON.stringify(s))}catch(e){console.error(e)}}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},o.apply(this,arguments)}const a=["https://query1.finance.yahoo.com","https://query2.finance.yahoo.com"],c=1e3;async function l(){var e;if(null!=(e=window.finWebCore)&&e.crumb)return window.finWebCore.crumb;const t=new URL(`${function(){const e=Math.floor(Math.random()*a.length);return a[e]}()}/v1/test/getcrumb`),s=await function(e,{method:t="GET",withCredentials:s=!0,headers:r={},body:i,timeout:a=c,errorMsg:l="Request failed",beaconString:u="financeWebCore",isFetchDisabled:f=!1,returnErrorInfo:h=!1}={}){return new Promise(((d,b)=>{const m=Date.now();function p(t={}){"object"==typeof t&&t&&(t.timestamp=m),n("info",u,{code:200,surl:e}),d(t)}function g(t={}){t.status=t.status||500,t.message=t.message||l,n("error",u,{code:t.status,msg:t.message,surl:e}),b(t)}f||void 0===window.fetch?function(e,{method:t="GET",withCredentials:s=!0,headers:r={},body:i,timeout:n=c,successCb:a,errorCb:l}){const u=new window.XMLHttpRequest;u.open(t,e,!0),u.timeout=n,u.withCredentials=s,u.onload=()=>{let e=u.responseText;if(u.status>=200&&u.status<300){if("string"==typeof e)try{e=""!==e?JSON.parse(e):{}}catch(e){return void l({status:502,message:e.message})}a(e)}else l({status:u.status||502,message:u.responseText})},u.onerror=()=>{l({status:u.status||500,message:u.responseText})};const f=o({},"GET"!==t?{"Content-Type":"application/json"}:{},r);Object.keys(f).forEach((e=>{u.setRequestHeader(e,f[e])})),u.send(i?JSON.stringify(i):void 0)}(e,{method:t,withCredentials:s,headers:r,body:i,timeout:a,successCb:p,errorCb:g}):function(e,{method:t="GET",withCredentials:s=!0,headers:r={},body:i,returnErrorInfo:n,timeout:a=c,successCb:l,errorCb:u}){const f=new window.AbortController;let h=!1;const d=setTimeout((function(){h=!0,f.abort(),clearTimeout(d),u({status:502,message:"Request Timeout"})}),a);window.fetch(e,{method:t,mode:"cors",credentials:s?"include":"omit",headers:o({},"GET"!==t?{"Content-Type":"application/json"}:{},r),signal:f.signal,body:i?JSON.stringify(i):null}).then((async e=>{if(!h){if(clearTimeout(d),!e.ok){let r;var t,s;return n&&(r=null==(s=((null==(t=e.headers)||null==t.get||null==(t=t.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{}).finance)?void 0:s.error),Promise.reject(o({status:e.status||502,message:e.statusText},r&&{info:r}))}return e.text()}})).then((e=>{let t=e;"application/json"===((null==r?void 0:r["Content-Type"])||"application/json")&&(t=""!==e?JSON.parse(e):{}),l(t)})).catch((e=>{h||u(o({status:e.status||502,message:e.message},e.info&&{info:e.info}))}))}(e,{method:t,withCredentials:s,headers:r,body:i,returnErrorInfo:h,timeout:a,successCb:p,errorCb:g})}))}(t.toString(),{errorMsg:"crumb fetch failed",headers:{"Content-Type":"text/plain"},timeout:1e3});return window.finWebCore.crumb=s,s}const u={};function f(e,t="en-US",s={}){const r=`${t}${e}`;return u[r]||(u[r]=Intl.NumberFormat(t,s)),u[r]}function h({field:e,value:t,lang:s="en-US",priceHint:r,gmtOffSetMilliseconds:i,timeZoneShort:n,formatStyle:o}){const a={raw:t};switch(e){case"regularMarketVolume":case"marketCap":{a.fmt=function(e,t=3){const s=Math.abs(e);return s>=1e12?`${(e/1e12).toFixed(t)}T`:s>=1e9?`${(e/1e9).toFixed(t)}B`:s>=1e6?`${(e/1e6).toFixed(t)}M`:s>=1e3?`${(e/1e3).toFixed(t)}k`:e.toFixed(0)}(t);const e=f("marketCap",s,{maximumFractionDigits:0});a.longFmt=e.format(t);break}case"dailyPercentGain":case"totalPercentGain":case"extendedMarketChangePercent":case"postMarketChangePercent":case"preMarketChangePercent":case"regularMarketChangePercent":{let e=t;isNaN(t)||(e=t/100);const i=r?{minimumFractionDigits:r,maximumFractionDigits:r}:{minimumFractionDigits:2,maximumFractionDigits:4};i.style="percent";const n=f(`regularMarketChangePercent${r}`,s,i);a.fmt=n.format(e);break}case"extendedMarketTime":case"preMarketTime":case"postMarketTime":case"regularMarketTime":a.fmt=n&&"number"==typeof i?function(e,t,s){let r="string"==typeof(i=t)?Number(i):"number"==typeof i?i:"object"==typeof i&&i instanceof Date?i.getTime():Date.now();var i;return void 0!==e.gmtOffSetMilliseconds&&("string"==typeof e.gmtOffSetMilliseconds&&(e.gmtOffSetMilliseconds=Number(e.gmtOffSetMilliseconds)),n=r,o=e.gmtOffSetMilliseconds,r=isNaN(o)?n:n+6e4*new Date(n).getTimezoneOffset()+o),function(e,t={}){const{useUTC:s=!1,fmt:r="%I:%M%P",timeZoneShort:i=""}=t;let n="",o="",a="",c="",l=0,u=0,f="";for(;-1!==(u=r.indexOf("%",u));){switch(l!==u&&(c+=r.substring(l,u)),u+=1,f=r[u],f){case"l":case"I":o||(o=s?e.getUTCHours():e.getHours(),o<12?(o=0===o?"12":String(o),n="am"):(o>12&&(o-=12),o=String(o),n="pm")),"I"===f&&1===o.length?c+=`0${o}`:c+=o;break;case"M":a||(a=String(s?e.getUTCMinutes():e.getMinutes()),1===a.length&&(a=`0${a}`)),c+=a;break;case"p":case"P":n||(n=(s?e.getUTCHours():e.getHours())<12?"am":"pm"),c+="p"===f?"am"===n?"AM":"PM":n;break;case"Z":c+=i;break;case"%":c+="%";break;case"Y":c+=e.getFullYear();break;case"m":c+=`0${e.getMonth()+1}`.slice(-2);break;case"d":c+=`0${e.getDate()}`.slice(-2)}u+=1,l=u}return l<r.length&&(c+=r.substr(l)),c}(new Date(r),{fmt:s||"%l:%M %p %Z",timeZoneShort:e.timeZoneShort,useUTC:e.useUTC});var n,o}({timeZoneShort:n,gmtOffSetMilliseconds:i},1e3*t,"%l:%M%p %Z"):"-";break;default:{const e=r?{minimumFractionDigits:r,maximumFractionDigits:r}:{minimumFractionDigits:2,maximumFractionDigits:4};o&&(e.style=o);const i=f(`defaultFormatter${r}`,s,e);a.fmt=i.format(t)}}return a}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},d.apply(this,arguments)}function b(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const m={exchange:!0,shortName:!0,priceHint:!0,quoteType:!0,marketState:!0,symbol:!0,miniOption:!0,fromcurrency:!0,lastMarket:!0,circulatingSupply:!0,optionsType:!0,longName:!0},p={dailyGain:!0,dailyPercentGain:!0,totalGain:!0,totalPercentGain:!0,annualGainPercentage:!0,currentMarketValue:!0},g="_isPortfolio",y={marketState:!0,preMarketTime:!0,postMarketTime:!0,regularMarketTime:!0,extendedMarketTime:!0},v="add";function k({symbols:e,fields:t}){const s=null==t?void 0:t.filter((e=>e)),r=null==e?void 0:e.filter((e=>e));return{symbols:null!=r?r:[],fields:null!=s?s:[]}}"undefined"!=typeof window&&(window.finQuoteStreamer=new class{constructor(){var e=this;b(this,"updateSubscribers",(async function(t,{symbols:s,fields:r,callback:i,priceHint:n,formatStyle:o,permanent:a=!1}){const c=[];for(let f=0;f<s.length;f++){const h=s[f];e.subscriberMap[h]||(e.subscriberMap[h]={});const d=e.subscriberMap[h],b=t===v||r?r:Object.keys(d);for(let s=0;s<b.length;s++){var l;const r=b[s];d[r]||(d[r]=[]),y[r]&&t===v&&void 0===(null==(l=e.quoteData[h])?void 0:l.gmtOffSetMilliseconds)&&c.push(h);const f=d[r];switch(t){case v:{var u;const t={callback:i};"number"==typeof n&&(t.priceHint=n),"string"==typeof o&&(t.formatStyle=o),!0===a&&(d._permanent=a),d[g]=!!p[r],f.push(t),e.fieldMap[r]=(null!=(u=e.fieldMap[r])?u:0)+1;break}default:{let t=-1;for(let e=0;e<f.length;e++)if(f[e].callback===i){t=e;break}-1!==t&&(f.splice(t,1),e.fieldMap[r]--,0===f.length&&(delete e.subscriberMap[h][r],0===Object.keys(e.subscriberMap[h]).length&&delete e.subscriberMap[h]),0===e.fieldMap[r]&&delete e.fieldMap[r])}}}}})),b(this,"onUpdate",(e=>{const{data:t}=e,{finWebCore:s}=window,{cmd:r,symbols:i,quoteData:n}=t||{};if("subscribe"===r)return void this.subscribe({callback:Function.prototype,symbols:i,fields:["currency","regularMarketPrice","regularMarketChange"],type:"streamer"});if("unsubscribe"===r)return void this.unsubscribe({callback:Function.prototype,symbols:i,fields:["currency","regularMarketPrice","regularMarketChange"],type:"streamer"});if(!n)return;const o=[];Object.entries(n).forEach((([e,t])=>{if(!t)return;const{price:r={},summaryDetail:i={}}=t,n=t.price?d({},r,i):t;this.quoteData[e]=Object.assign({},this.quoteData[e],n);const a=this.subscriberMap[e];a&&Object.entries(n).forEach((([t,r])=>{const i=a[t]||[],n={};for(const a of i){const{priceHint:i,gmtOffSetMilliseconds:c,exchangeTimezoneShortName:l,timeZoneShortName:u}=this.quoteData[e],{priceHint:f,formatStyle:d}=a,b=`${f||i}${d}`;let p=n[b];void 0===p&&(p=m[t]?r:h({field:t,value:r,lang:(null==s?void 0:s.lang)||"en-US",priceHint:f||i,gmtOffSetMilliseconds:c,timeZoneShort:l||u,formatStyle:a.formatStyle}),n[b]=p),this.quoteData[e][t]=p,o.push([a,p,{field:t,quote:this.quoteData[e]}])}}))})),o.forEach((e=>{e[0].callback(e[1],e[2])}))})),b(this,"getSymbols",((e=!1)=>{const t=[];for(const s in this.subscriberMap){const r=e?this.subscriberMap[s][g]:!this.subscriberMap[s][g];Object.prototype.hasOwnProperty.call(this.subscriberMap,s)&&r&&t.push(s)}return t})),b(this,"handleFocus",(()=>{this.pauseSubscription({symbols:this.getSymbols()},!0)})),b(this,"handleBlur",(()=>{this.pauseSubscription({symbols:this.getSymbols()})})),b(this,"subscribe",(({symbols:e,fields:t,type:s="streamer",userId:r,callback:i,priceHint:n,formatStyle:o,permanent:a=!1})=>{var c,l;const u=k({symbols:e,fields:t}),{finWebCore:f}=window;if((null==(c=u.symbols)?void 0:c.length)>0&&(null==(l=u.fields)?void 0:l.length)>0){this.updateSubscribers("add",{symbols:u.symbols,fields:u.fields,priceHint:n,formatStyle:o,permanent:a,callback:i});const e=(null==f?void 0:f.crumb)||"",t=this.getSymbols(),c=this.getSymbols(!0);t.length>0&&this.messageToWorker({cmd:"subscribe",type:s,crumb:e,symbols:t,fields:Object.keys(this.fieldMap)}),c.length>0&&(null!=f&&f.userId||(f.userId=r),this.messageToWorker({cmd:"subscribe",crumb:e,userId:(null==f?void 0:f.userId)||"",symbols:c},"portfolio"))}})),b(this,"unsubscribe",(({symbols:e,fields:t,type:s="streamer",callback:r})=>{var i,n;const{finWebCore:o}=window,a=k({symbols:e,fields:t});if((null==(i=a.symbols)?void 0:i.length)>0&&(null==(n=a.fields)?void 0:n.length)>0){this.updateSubscribers("remove",{symbols:a.symbols,fields:a.fields,callback:r});const e=(null==o?void 0:o.crumb)||"",t=this.getSymbols(),i=this.getSymbols(!0);t.length>0&&this.messageToWorker({cmd:"unsubscribe",type:s,crumb:e,symbols:t,fields:Object.keys(this.fieldMap)}),i.length>0&&this.messageToWorker({cmd:"unsubscribe",crumb:e,symbols:i},"portfolio")}})),b(this,"pauseSubscription",(({symbols:e},t=!1)=>{var s;const{finWebCore:r}=window,i=k({symbols:e,fields:[]});if((null==(s=i.symbols)?void 0:s.length)>0){const e=[],s=[];let n=[];const o=new Set(i.symbols);Object.entries(this.subscriberMap).forEach((([r,i])=>{const{_permanent:a}=i;(a||(t?o.has(r):!o.has(r)))&&(n=[...n,...Object.keys(i)],i[g]?s.push(r):e.push(r))}));const a=(null==r?void 0:r.crumb)||"";e.length>0&&this.messageToWorker({cmd:t?"subscribe":"unsubscribe",type:"streamer",crumb:a,symbols:e,fields:Array.from(new Set(n))}),s.length>0&&this.messageToWorker({cmd:t?"subscribe":"unsubscribe",crumb:a,userId:(null==r?void 0:r.userId)||"",symbols:s},"portfolio")}})),b(this,"messageToWorker",((e,t="quote")=>{this.channels[t].port1.postMessage(e)})),b(this,"init",(()=>{new URLSearchParams(window.location.search).has("disableStreaming")||(this.subscriberMap={},void 0===i||this.worker||(this.worker=new i,this.channels.quote.port1.onmessage=this.onUpdate,this.worker.postMessage({cmd:"init"},[this.channels.quote.port2]),this.worker.postMessage({cmd:"init-qpf"},[this.channels["quote:pf"].port2])),void 0===i||this.portfolioWorker||(this.portfolioWorker=new r,this.channels.portfolio.port1.onmessage=this.onUpdate,this.portfolioWorker.postMessage({cmd:"init"},[this.channels.portfolio.port2]),this.portfolioWorker.postMessage({cmd:"init-qpf"},[this.channels["quote:pf"].port1])),addEventListener("focus",this.handleFocus),addEventListener("blur",this.handleBlur),this.initialized||(Promise.resolve().then(s.bind(s,8277)).then((()=>{this.initialized=!0})),l()))})),this.subscriberMap={},this.fieldMap={},this.worker=null,this.portfolioWorker=null,this.channels={portfolio:new MessageChannel,quote:new MessageChannel,"quote:pf":new MessageChannel},this.quoteData={},this.initialized=!1}},window.finQuoteStreamer.init())})()})();